<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="css/admin.css" type="text/css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="/admin">Admin</a>
                    </li>
                    <li>
                        <a href="/">Home</a>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/logout">Logout</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        {{{body}}}
    </main>

    <script src="jquery.min.js"></script>
    <script src="jquery.validate.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script src='https://www.google.com/recaptcha/api.js'></script>

    {{!--TODO(Domi): Figure out a way to add section scripts!--}}
    <script>
        $(document).ready(function () {
            const SCALE_FACTOR = 4;

            var $images = $("[id^='js-img-']");

            if ($images.length) {
                $images.on('mouseover', function (event) {
                    var $target = $(event.target);

                    var id = $target.attr('id');
                    var imgPreviewId = 'js-img-preview-' + id.substring(17);

                    $('<img>')
                        .attr('src', $target.attr('src'))
                        .attr('id', imgPreviewId)
                        .css({
                            "position": "absolute",
                            "left": $target.position().left - $target.width(),
                            "top": $target.position().top - $target.height(),
                            "width": $target.width() * SCALE_FACTOR,
                            "height": $target.height() * SCALE_FACTOR,
                            "border-radius": "5px"
                        }).appendTo($target.parent());
                });
            };

            $('.img-preview-container').on('mouseleave', function (event) {
                $previewImage = $("[id^='js-img-preview-']");
                if ($previewImage) {
                    $previewImage.remove();
                }
            });
        });

        $(document).ready(function () {
            $(document).on('change', '.btn-file :file', function () {
                var input = $(this),
                    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
                input.trigger('fileselect', [label]);
            });

            $('.btn-file :file').on('fileselect', function (event, label) {

                var input = $(this).parents('.input-group').find(':text'),
                    log = label;

                if (input.length) {
                    input.val(log);
                } else {
                    if (log) alert(log);
                }

            });
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#img-upload').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            $("#imgInp").change(function () {
                readURL(this);
            });
        });

        $(document).ready(function () {
            $('#upload-image').submit(function (event) {
                event.preventDefault();
                var formData = new FormData($(this)[0]);
                console.log(formData);
                $.ajax({
                    type: 'post',
                    url: '/admin',
                    data: formData,
                    cache: false,
                    contentType: false,
                    enctype: 'multipart/form-data',
                    processData: false,
                    success: function (data) {
                        //console.log(data);
                    }
                });
            });
        })
    </script>
</body>

</html>